package com.myntra.apiTests.erpservices.oms.dp;

import com.myntra.apiTests.erpservices.oms.OMSServiceHelper;
import com.myntra.apiTests.erpservices.rms.RMSServiceHelper;
import com.myntra.lordoftherings.Toolbox;
import com.myntra.lordoftherings.boromir.DBUtilities;
import org.testng.ITestContext;
import org.testng.annotations.DataProvider;

import javax.xml.bind.JAXBException;
import java.io.UnsupportedEncodingException;
import java.sql.SQLException;

/**
 * Created by abhijit.pati on 15/03/16.
 */
public class OMSPriceOverrideDP {

    static OMSServiceHelper omsServiceHelper = new OMSServiceHelper();
    static String login = "omspriceoverride1@gmail.com";
    static String uidx = "ddabd587.5a37.43a9.bbaa.665ee6602e82V0SModhR8B";

    @DataProvider(name = "returnOfAPriecOverRideItemDP")
    public static Object[][] returnOfAPriecOverRideItemDP(ITestContext testContext)
            throws SQLException, UnsupportedEncodingException, JAXBException {
        RMSServiceHelper rmsServiceHelper = new RMSServiceHelper();
        String order_pps_70045620 = "<order><createdBy>omspriceoverride1@gmail.com</createdBy><createdOn>2016-03-15T15:55:41+05:30</createdOn><id>70045633</id><lastModifiedOn>2016-03-15T15:59:42+05:30</lastModifiedOn><version>5</version><billingAddress><createdBy>pps-admin</createdBy><createdOn>2016-03-15T15:55:41+05:30</createdOn><id>115</id><lastModifiedOn>2016-03-15T15:55:41+05:30</lastModifiedOn><version>0</version><billingAddress></billingAddress><billingCity></billingCity><billingCounty></billingCounty><billingEmail>omspriceoverride1@gmail.com</billingEmail><billingFirstName></billingFirstName><billingLastName></billingLastName><billingMobile>1234567890</billingMobile><billingState></billingState><billingZipCode></billingZipCode></billingAddress><cartDiscount>0</cartDiscount><cashBackCouponCode></cashBackCouponCode><cashRedeemed>0</cashRedeemed><cashbackOffered>0</cashbackOffered><channel>web</channel><codCharge>0</codCharge><couponCode></couponCode><couponDiscount>0</couponDiscount><customerName>EXPRESS</customerName><discount>0</discount><earnedCredit>0</earnedCredit><emiCharge>0</emiCharge><finalAmount>801</finalAmount><giftCardAmount>0</giftCardAmount><giftCharge>0</giftCharge><giftOrder>false</giftOrder><login>ddabd587.5a37.43a9.bbaa.665ee6602e82V0SModhR8B</login><loyaltyConversionFactor>0</loyaltyConversionFactor><loyaltyPointsCredit>0</loyaltyPointsCredit><loyaltyPointsUsed>0</loyaltyPointsUsed><mrpTotal>799</mrpTotal><notes></notes><onHold>false</onHold><onHoldReason>Payments Pending Confirmation</onHoldReason><onHoldReasonId>39</onHoldReasonId><orderProcessingFlowMode>OMS</orderProcessingFlowMode><orderReleases><orderRelease><createdBy>omspriceoverride1@gmail.com</createdBy><createdOn>2016-03-15T15:55:41+05:30</createdOn><id>70045633</id><lastModifiedOn>2016-03-15T16:13:55+05:30</lastModifiedOn><version>10</version><address>AKR A, 3RD FLOOR, HARLUR ROAD</address><addressId>6118982</addressId><cartDiscount>0</cartDiscount><cashRedeemed>0</cashRedeemed><city>Bangalore</city><codCharge>0</codCharge><codPaymentStatus>pending</codPaymentStatus><country>India</country><couponDiscount>0</couponDiscount><courierCode>ML</courierCode><courierDisplayName>Myntra Logistics</courierDisplayName><customerPromiseTime>2016-03-19T23:01:02+05:30</customerPromiseTime><deliveredOn>2016-03-15T16:13:55+05:30</deliveredOn><discount>0</discount><earnedCredit>0</earnedCredit><email>omspriceoverride1&amp;&#x23;x40&#x3b;gmail.com</email><emiCharge>0</emiCharge><expectedCutoffTime>2016-03-15T23:01:02+05:30</expectedCutoffTime><expectedDeliveryPromise>2016-03-19T23:01:02+05:30</expectedDeliveryPromise><expectedPackingTime>2016-03-15T23:00:47+05:30</expectedPackingTime><expectedPickingTime>2016-03-15T21:00:47+05:30</expectedPickingTime><expectedQCTime>2016-03-15T21:00:47+05:30</expectedQCTime><finalAmount>801</finalAmount><gift>false</gift><giftCardAmount>0</giftCardAmount><giftCharge>0</giftCharge><locality>Bommanahalli  &#x28;Bangalore&#x29;</locality><login>ddabd587.5a37.43a9.bbaa.665ee6602e82V0SModhR8B</login><loyaltyConversionFactor>0</loyaltyConversionFactor><loyaltyPointsCredit>0</loyaltyPointsCredit><loyaltyPointsUsed>0</loyaltyPointsUsed><mobile>1234567890</mobile><mrpTotal>799</mrpTotal><onHold>false</onHold><orderId>70045633</orderId><orderLines><orderLine><createdBy>omspriceoverride1@gmail.com</createdBy><createdOn>2016-03-15T15:55:41+05:30</createdOn><id>52710294</id><lastModifiedOn>2016-03-15T16:13:55+05:30</lastModifiedOn><version>4</version><cartDiscount>0</cartDiscount><cashRedeemed>0</cashRedeemed><cashbackOffered>0</cashbackOffered><couponDiscount>0</couponDiscount><customizedMessage></customizedMessage><discount>0</discount><discountRuleId>0</discountRuleId><discountRuleRevId>0</discountRuleRevId><discountedProduct>false</discountedProduct><discountedQuantity>0</discountedQuantity><earnedCredit>0</earnedCredit><finalAmount>799</finalAmount><fragile>false</fragile><giftCardAmount>0</giftCardAmount><govtTaxAmount>39.95</govtTaxAmount><govtTaxRate>5.25</govtTaxRate><govtTaxType>CST</govtTaxType><govtTaxableAmount>761.05</govtTaxableAmount><hazMat>false</hazMat><isCustomizable>false</isCustomizable><isDiscountedProduct>false</isDiscountedProduct><isExchangeableProduct>true</isExchangeableProduct><isFragile>false</isFragile><isHazMat>false</isHazMat><isJewellery>false</isJewellery><isReturnableProduct>true</isReturnableProduct><jewellery>false</jewellery><loyaltyConversionFactor>0</loyaltyConversionFactor><loyaltyPointsAwarded>0</loyaltyPointsAwarded><loyaltyPointsCredit>0</loyaltyPointsCredit><loyaltyPointsUsed>0</loyaltyPointsUsed><optionId>4853</optionId><orderId>70045633</orderId><orderReleaseId>70045633</orderReleaseId><packagingStatus>NOT_PACKAGED</packagingStatus><packagingType>NORMAL</packagingType><pgDiscount>0</pgDiscount><poStatus>UNUSED</poStatus><priceMismatchRefund>49</priceMismatchRefund><priceMismatchRefundPpsId>b6729f0e-6220-4017-bb2a-d451b92d07fa</priceMismatchRefundPpsId><quantity>1</quantity><sellerId>1</sellerId><skuId>3832</skuId><status>D</status><statusDisplayName>Delivered</statusDisplayName><storedCredit>0</storedCredit><styleId>1531</styleId><supplyType>ON_HAND</supplyType><taxAmount>0</taxAmount><taxRate>5</taxRate><unitPrice>799</unitPrice></orderLine></orderLines><paymentMethod>on</paymentMethod><paymentMethodDisplay>Online</paymentMethodDisplay><personalized>false</personalized><pgDiscount>0</pgDiscount><queuedOn>2016-03-15T15:55:47+05:30</queuedOn><receiverName>EXPRESS </receiverName><refunded>false</refunded><sellerProcessingEndTime>2016-03-17T20:45:42+05:30</sellerProcessingEndTime><sellerProcessingStartTime>2016-03-15T15:57:42+05:30</sellerProcessingStartTime><shippingCharge>2</shippingCharge><shippingMethod>NORMAL</shippingMethod><singleItemRelease>false</singleItemRelease><specialPincode>false</specialPincode><state>KA</state><status>DL</status><statusDisplayName>Delivered</statusDisplayName><storeId>1</storeId><storedCredit>0</storedCredit><taxAmount>0</taxAmount><trackingNo>ML0008953413</trackingNo><userContactNo>1234567890</userContactNo><warehouseId>28</warehouseId><zipcode>560068</zipcode></orderRelease></orderReleases><orderType>on</orderType><orderTypeDisplay>Online</orderTypeDisplay><paymentMethod>on</paymentMethod><paymentMethodDisplay>Online</paymentMethodDisplay><paymentPpsId>1e722c0d-6ea6-4015-8a84-61b6171f39c6</paymentPpsId><pgDiscount>0</pgDiscount><queuedOn>2016-03-15T15:57:42+05:30</queuedOn><shippingCharge>2</shippingCharge><storeId>1</storeId><storedCredit>0</storedCredit><taxAmount>0</taxAmount><totalOrderValue>801</totalOrderValue><userContactNo>1234567890</userContactNo></order>";

        String payment_Plan_70045620 = "INSERT INTO `payment_plan` (`id`, `comments`, `updatedBy`, `updatedTimestamp`, `actionType`, `clientTransactionId`, `crmRefId`, `login`, `orderId`, `ppsType`, `sourceId`, `state`, `sessionId`, `cartContext`, `totalAmount`, `mobile`, `returnId`, `userAgent`, `clientIP`, `bankAccountId`) VALUES ('1e722c0d-6ea6-4015-8a84-61b6171f39c6', 'PPS Plan created', 'SYSTEM', 1458057575761, 'SALE', NULL, NULL, 'omspriceoverride1@gmail.com', '70045633', 'ORDER', 'e191b298-0e0c-42e0-86a7-cf697d300bbb--s3', 'PPFSM Order Taking done', 'JJN002b4b8dde7b0a4491c971f24c742e72bed1458057504M', 'DEFAULT', 80100, NULL, NULL, NULL, '1.1.1.1', NULL), ('93a3358d-a4e4-4ced-a3e5-8152f6bd93e8', 'PPS Plan created', 'SYSTEM', 1458057575761, 'CHILD_PARTIAL_RETURN', NULL, NULL, 'omspriceoverride1@gmail.com', '70045633', 'ORDER', '1e722c0d-6ea6-4015-8a84-61b6171f39c6', NULL, 'JJN002b4b8dde7b0a4491c971f24c742e72bed1458057504M', 'DEFAULT', 80100, NULL, NULL, NULL, '1.1.1.1', NULL),('b6729f0e-6220-4017-bb2a-d451b92d07fa', 'PPS Plan created', 'SYSTEM', 1458057734716, 'CANCELLATION', 'PRICE_OVERRIDE_REFUND52710294', NULL, 'omspriceoverride1@gmail.com', '70045633', 'ORDER', '1e722c0d-6ea6-4015-8a84-61b6171f39c6', 'PPFSM Refund done', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL);";

        String payment_plan_item_70045620 = "INSERT INTO `payment_plan_item` (`id`, `comments`, `updatedBy`, `updatedTimestamp`, `itemType`, `pricePerUnit`, `quantity`, `sellerId`, `skuId`, `pps_Id`) VALUES (896587170, 'Payment Plan Item created', 'SYSTEM', 1458057576125, 'SKU', 79900, 1, '1', '3832', '1e722c0d-6ea6-4015-8a84-61b6171f39c6'), (896587171, 'Payment Plan Item created', 'SYSTEM', 1458057576125, 'SHIPPING_CHARGES', 200, 1, '1', 'PPS_9999', '1e722c0d-6ea6-4015-8a84-61b6171f39c6'),(896587172, 'Line Item updated for Partial Refund from 79900  to  4900  with old quantity 1  to  1', 'SYSTEM', 1458057735132, 'SKU', 75000, 1, '1', '3832', '93a3358d-a4e4-4ced-a3e5-8152f6bd93e8'),(896587173, 'Payment Plan Item created', 'SYSTEM', 1458057576125, 'SHIPPING_CHARGES', 200, 1, '1', 'PPS_9999', '93a3358d-a4e4-4ced-a3e5-8152f6bd93e8'),(896587174, 'Payment Plan Item for crediting partial refund', 'SYSTEM', 1458057734784, 'PARTIAL_REFUND', 4900, 1, '1', '3832', 'b6729f0e-6220-4017-bb2a-d451b92d07fa');";

        String payment_plan_item_instrument_70045620 = "INSERT INTO `payment_plan_item_instrument` (`id`, `comments`, `updatedBy`, `updatedTimestamp`, `amount`, `paymentInstrumentType`, `ppsItemId`, `actionType`) VALUES (41925, 'Payment Plan Item Instrument Detail created', 'SYSTEM', 1458057576445, 79900, 0, 896587170, NULL),(41926, 'Payment Plan Item Instrument Detail created', 'SYSTEM', 1458057576445, 200, 0, 896587171, NULL),(41927, 'Line Item InstrumentDetail updated for Partial Refund from 79900  to  75000', 'SYSTEM', 1458057576445, 75000, 0, 896587172, NULL),(41928, 'Payment Plan Item Instrument Detail created', 'SYSTEM', 1458057576445, 200, 0, 896587173, NULL),(41929, NULL, 'SYSTEM', 1458057734799, 4900, 0, 896587174, 'REFUND');";

        String payment_plan_instrument_Details_70045620 = "INSERT INTO `payment_plan_instrument_details` (`id`, `comments`, `updatedBy`, `updatedTimestamp`, `paymentInstrumentType`, `totalPrice`, `pps_Id`, `paymentPlanExecutionStatus_id`, `actionType`,`parentInstrumentDetailId`) VALUES (27865, 'PPS Plan Instrument Details created', 'SYSTEM', 1458057576125, 0, 80100, '1e722c0d-6ea6-4015-8a84-61b6171f39c6', 9913498, 'DEBIT', NULL), (27866,'InstrumentDetail updated for Partial Refund from 80100  to  75200', 'SYSTEM', 1458057576125, 0, 75200, '93a3358d-a4e4-4ced-a3e5-8152f6bd93e8', 9913499, 'DEBIT', NULL),(27867, 'PPS Plan Instrument Details created', 'SYSTEM', 1458057735190, 0, 4900, 'b6729f0e-6220-4017-bb2a-d451b92d07fa', 9913500, 'REFUND', NULL);";

        String payment_plan_execution_status_70045620 = "INSERT INTO `payment_plan_execution_status` (`id`, `comments`, `updatedBy`, `updatedTimestamp`, `actionType`, `instrumentTransactionId`, `invoker`, `invokerTransactionId`, `numOfRetriesDone`, `ppsActionType`, `state`, `status`, `paymentPlanInstrumentDetailId`) VALUES (9913498, 'Payment Plan Execution Status created', 'SYSTEM', 1458057577079, 'DEBIT', '13728383', 'pps', '81f25ea9-e637-4938-b93f-eb94ea3a2591', 0, 'SALE', 'PIFSM Payment Successful', 0, 27865), (9913499, 'Payment Plan Execution Status created', 'SYSTEM', 1458057577079, 'DEBIT', '13728383', 'pps', '81f25ea9-e637-4938-b93f-eb94ea3a2591', 0, 'SALE', NULL, 0, 27866), (9913500, 'Payment Plan Execution Status created', 'SYSTEM', 1458057735286, 'REFUND', '13728384', 'pps', '1f9de6e7-7e33-4315-ac16-6019e4040a9e', 0, 'CANCELLATION', 'PIFSM Payment Successful', 0, 27867);";


        omsServiceHelper.deletePPSRecords("'1e722c0d-6ea6-4015-8a84-61b6171f39c6','93a3358d-a4e4-4ced-a3e5-8152f6bd93e8','b6729f0e-6220-4017-bb2a-d451b92d07fa'");
        omsServiceHelper.deletePPSRecordsByOrderID("70045633");
        omsServiceHelper.deleteOMSDBEntriesForOrderID("70045633");
        omsServiceHelper.chnageOlderOrdersToOnlineForCODTesting(uidx,login);
        DBUtilities.exUpdateQuery(payment_Plan_70045620, "pps");
        DBUtilities.exUpdateQuery(payment_plan_item_70045620, "pps");
        DBUtilities.exUpdateQuery(payment_plan_item_instrument_70045620, "pps");
        DBUtilities.exUpdateQuery(payment_plan_execution_status_70045620, "pps");
        DBUtilities.exUpdateQuery(payment_plan_instrument_Details_70045620, "pps");
        omsServiceHelper.createOrderInOMS(order_pps_70045620);
        DBUtilities.exUpdateQuery("update myntra_wms.item set item_status='SHIPPED', order_id=70045633, bin_id=271521, `last_modified_on`=now() where id='9100007';", "wms");


        String return_line_12234030 = "INSERT INTO `return_line` (`id`, `return_id`, `order_id`, `order_release_id`, `order_line_id`, `exchange_id`, `sku_id`, `option_id`, `return_reason_id`, `unit_price`, `refund_amount`, `is_refunded`, `refunded_on`, `rejected_on`, `restocked_on`, `qa_pass_on`, `qa_fail_on`, `sv_pass_on`, `sv_fail_on`, `cc_review_pass_on`, `cc_review_fail_on`, `created_by`, `created_on`, `last_modified_on`, `version`, `status_code`, `item_barcode`, `supply_type`, `warehouse_id`, `group_key`, `style_id`, `sku_code`, `quality`, `seller_id`) VALUES (999149994, 12234033, 70045633, 70045633, 52710294, NULL, 3832, 4853, 7, 799.00, 750.00, 0, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 'RMS-SYSTEM', '2016-03-16 00:08:53', '2016-03-16 00:08:56', 2, 'RPI', '9100007', 'ON_HAND', 28, '0', 1531, 'PUMATSRM01400', NULL, 1);";
        String return_12234030 = "INSERT INTO `returns` (`id`, `order_id`, `parent_return_id`, `exchange_id`, `status_code`, `login`, `customer_name`, `mobile`, `email`, `address`, `city`, `country`, `state`, `zipcode`, `address_id`, `return_comment`, `delivery_credit`, `pickup_charges`, `refund_mode`, `refund_amount`, `is_refunded`, `refund_account_id`, `refunded_on`, `cancellation_reason_id`, `cancelled_on`, `courier_code`, `tracking_no`, `dc_code`, `warehouse_id`, `delivered_on`, `pickup_failed_on`, `pickup_init_on`, `return_mode`, `pickup_on`, `dc_accepted_on`, `recieved_on`, `rejected_on`, `created_by`, `created_on`, `last_modified_on`, `version`, `user_id`, `store_id`, `store_return_id`) VALUES (12234033, 70045633, NULL, NULL, 'RPI', 'ddabd587.5a37.43a9.bbaa.665ee6602e82V0SModhR8B', 'Automation', '1234567890', 'omspriceoverride1@gmail.com', 'AKR B, Myntra Design', 'Bangalore', 'India', 'KA', '560067', 6130578, 'Return created from MyMyntra', 0.00, 0.00, 'CASHBACK', 750.00, 0, '', NULL, NULL, NULL, 'ML', NULL, NULL, NULL, NULL, NULL, NULL, 'PICKUP', NULL, NULL, NULL, NULL, 'RMS-SYSTEM', '2016-03-16 00:08:53', '2016-03-16 00:08:53', 1, NULL, NULL, NULL);";

        rmsServiceHelper.DeleteReturn(70045633);
        DBUtilities.exUpdateQuery(return_12234030, "rms");
        DBUtilities.exUpdateQuery(return_line_12234030, "rms");

        Object[][] dataSet = new Object[][] { { "12234033" } };
        return Toolbox.returnReducedDataSet(dataSet, testContext.getIncludedGroups(), 1, 1);
    }

}
