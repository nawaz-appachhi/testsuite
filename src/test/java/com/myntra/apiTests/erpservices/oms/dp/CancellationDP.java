package com.myntra.apiTests.erpservices.oms.dp;

import com.myntra.apiTests.erpservices.oms.OMSServiceHelper;
import com.myntra.apiTests.end2end.End2EndHelper;
import com.myntra.apiTests.erpservices.atp.ATPServiceHelper;
import com.myntra.apiTests.erpservices.bounty.BountyServiceHelper;
import com.myntra.apiTests.erpservices.ims.IMSServiceHelper;
import com.myntra.apiTests.erpservices.oms.Test.OMSTCConstants;
import com.myntra.apiTests.erpservices.sellerapis.SellerConfig;
import com.myntra.lordoftherings.Initialize;
import com.myntra.lordoftherings.Toolbox;
import com.myntra.lordoftherings.boromir.DBUtilities;
import com.myntra.oms.client.entry.OrderEntry;
import com.myntra.oms.client.entry.OrderLineEntry;
import com.myntra.oms.client.entry.OrderReleaseEntry;
import com.myntra.test.commons.testbase.BaseTest;

import org.testng.ITestContext;
import org.testng.annotations.DataProvider;

import javax.xml.bind.JAXBException;

import java.io.UnsupportedEncodingException;
import java.sql.SQLException;
import java.util.List;

/**
 * 
 * @author abhijit.pati
 *
 */
public class CancellationDP extends BaseTest {

    static Initialize init = new Initialize("/Data/configuration");
    static OMSServiceHelper omsServiceHelper = new OMSServiceHelper();
	static BountyServiceHelper bountyServiceHelper = new BountyServiceHelper();
	static End2EndHelper end2EndHelper = new End2EndHelper();
	static String login = OMSTCConstants.OMSLineCancellationTest.LOGIN_URL;
	static String uidx = "f08fafc6.e1b3.4007.8f91.0084813d4386DEBbt0zepG";
	static String password = OMSTCConstants.OMSLineCancellationTest.PASSWORD;
	static IMSServiceHelper IMSServiceHelper = new IMSServiceHelper();
	static ATPServiceHelper atpserviceHelper = new ATPServiceHelper();
	private static OrderEntry orderEntry;
	private static List<OrderReleaseEntry> orderReleaseEntries;
	private static String orderReleaseId;
	static Long vectorSellerID = SellerConfig.getSellerID(SellerConfig.SellerName.HANDH);
	private static String supplyTypeOnHand = "ON_HAND";


    @DataProvider(name = "checkSingleItemLineCancellationTriggerReleaseCancellationDP")
	public static Object[][] checkSingleItemLineCancellationTriggerReleaseCancellationDP(ITestContext testContext)
            throws Exception {
        String[] skuId = {OMSTCConstants.OtherSkus.skuId_3832+":5"};
        atpserviceHelper.updateInventoryDetailsForSeller(new String[]{OMSTCConstants.OtherSkus.skuId_3832+":"+OMSTCConstants.WareHouseIds.warehouseId36_BW+":1000:0:"+vectorSellerID+":1"}, supplyTypeOnHand);
        IMSServiceHelper.updateInventoryForSeller(new String[]{OMSTCConstants.OtherSkus.skuId_3832+":"+OMSTCConstants.WareHouseIds.warehouseId36_BW+":1000:0:"+vectorSellerID}, supplyTypeOnHand );
        String orderID = end2EndHelper.createOrder(login, password, OMSTCConstants.Pincodes.PINCODE_560068, skuId, "", false, false, false, "", false);
        
        Object[][] dataSet = new Object[][] { { orderID, login } };
		return Toolbox.returnReducedDataSet(dataSet, testContext.getIncludedGroups(), 1, 1);
		
	}

    @Deprecated
    @DataProvider(name = "checkLineCancellationForEachQuantityWhereLPAndCBIsUsedDP")
    public static Object[][] checkLineCancellationForEachQuantityWhereLPAndCBIsUsedDP(ITestContext testContext)
            throws Exception {
        String[] skuid = {OMSTCConstants.OtherSkus.skuId_3832+":5"};
        end2EndHelper.updateloyalityAndCashBack(uidx, 990, 3500);
        String orderID = end2EndHelper.createOrder(login, password, OMSTCConstants.Pincodes.PINCODE_560068, skuid, "", true, true, false, "", false);
        omsServiceHelper.checkReleaseStatusForOrder(orderID,"WP");
        orderEntry = omsServiceHelper.getOrderEntry(orderID);
        orderReleaseId = orderEntry.getOrderReleases().get(0).getId().toString();
        List<OrderLineEntry> orderLineEntries = omsServiceHelper.getOrderLineEntries(orderReleaseId);
        String lineID = ""+orderLineEntries.get(0).getId();
        Object[][] dataSet = new Object[][] { { lineID, orderID, uidx } };
        return Toolbox.returnReducedDataSet(dataSet, testContext.getIncludedGroups(), 11, 11);
    }


    @DataProvider(name = "checkSingleReleaseMultipleItemCancellationDP")
	public static Object[][] checkSingleReleaseMultipleItemCancellationDP(ITestContext testContext)
			throws Exception {
		String[] skuid = {OMSTCConstants.OtherSkus.skuId_3832+":2",OMSTCConstants.OtherSkus.skuId_3834+":2"};
		atpserviceHelper.updateInventoryDetailsForSeller(new String[]{OMSTCConstants.OtherSkus.skuId_3832+":"+OMSTCConstants.WareHouseIds.warehouseId28_GN+":1000:0:"+vectorSellerID+":1",
				OMSTCConstants.OtherSkus.skuId_3834+":"+OMSTCConstants.WareHouseIds.warehouseId28_GN+":1000:0:"+vectorSellerID+":1"}, supplyTypeOnHand);
        IMSServiceHelper.updateInventoryForSeller(new String[]{OMSTCConstants.OtherSkus.skuId_3832+":"+OMSTCConstants.WareHouseIds.warehouseId28_GN+":1000:0:"+vectorSellerID,
        		OMSTCConstants.OtherSkus.skuId_3834+":"+OMSTCConstants.WareHouseIds.warehouseId28_GN+":1000:0:"+vectorSellerID}, supplyTypeOnHand );
        
        String orderID = end2EndHelper.createOrder(login, password, OMSTCConstants.Pincodes.PINCODE_560068, skuid, "", false, false, false, "", false);
        
		Object[][] dataSet = new Object[][] { { orderID, login } };
		return Toolbox.returnReducedDataSet(dataSet, testContext.getIncludedGroups(), 11, 11);
	}

    @DataProvider(name = "checkMultipleReleaseMultipleItemCancellationDP")
    public static Object[][] checkMultipleReleaseMultipleItemCancellationDP(ITestContext testContext)
            throws Exception {
        String[] skuid = {OMSTCConstants.OtherSkus.skuId_3831 +":2",OMSTCConstants.OtherSkus.skuId_3834+":2"};
        
        atpserviceHelper.updateInventoryDetailsForSeller(new String[]{OMSTCConstants.OtherSkus.skuId_3831 +":"+OMSTCConstants.WareHouseIds.warehouseId28_GN+":1000:0:"+vectorSellerID+":1",OMSTCConstants.OtherSkus.skuId_3834+":"+OMSTCConstants.WareHouseIds.warehouseId36_BW+":1000:0:"+vectorSellerID+":1"},supplyTypeOnHand);
        IMSServiceHelper.updateInventoryForSeller(new String[]{OMSTCConstants.OtherSkus.skuId_3831 +":"+OMSTCConstants.WareHouseIds.warehouseId28_GN+":10000:0:"+vectorSellerID+":1",OMSTCConstants.OtherSkus.skuId_3834+":"+OMSTCConstants.WareHouseIds.warehouseId36_BW+":1000:0:"+vectorSellerID},supplyTypeOnHand);
        String orderID = end2EndHelper.createOrder(login, password, OMSTCConstants.Pincodes.PINCODE_560068, skuid, "", false, false, false, "", false);
       
        Object[][] dataSet = new Object[][] { { orderID , login } };
        return Toolbox.returnReducedDataSet(dataSet, testContext.getIncludedGroups(), 11, 11);
    }

    @DataProvider(name = "cancelReleaseOfAPackOrderDP")
	public static Object[][] cancelReleaseOfAPackOrderDP(ITestContext testContext)
			throws SQLException, UnsupportedEncodingException, JAXBException {
		String order_pps_70042952 = "<order><createdBy>end2endautomation1@gmail.com</createdBy><createdOn>2016-02-29T12:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":19+05:30</createdOn><id>70042952</id><lastModifiedOn>2016-02-29T13:14:15+05:30</lastModifiedOn><version>3</version><billingAddress><createdBy>pps-admin</createdBy><createdOn>2016-02-29T13:15:10+05:30</createdOn><id>1547</id><lastModifiedOn>2016-02-29T13:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":54+05:30</lastModifiedOn><version>0</version><billingAddress></billingAddress><billingCity></billingCity><billingCounty></billingCounty><billingEmail>end2endautomation1@gmail.com</billingEmail><billingFirstName></billingFirstName><billingLastName></billingLastName><billingMobile>9439543863</billingMobile><billingState></billingState><billingZipCode></billingZipCode></billingAddress><cartDiscount>0</cartDiscount><cashBackCouponCode></cashBackCouponCode><cashRedeemed>0</cashRedeemed><cashbackOffered>0</cashbackOffered><channel>web</channel><codCharge>0</codCharge><couponCode></couponCode><couponDiscount>0</couponDiscount><customerName>END2END Automation1</customerName><discount>0</discount><earnedCredit>0</earnedCredit><emiCharge>0</emiCharge><finalAmount>801</finalAmount><giftCardAmount>0</giftCardAmount><giftCharge>0</giftCharge><giftOrder>false</giftOrder><login>end2endautomation1@gmail.com</login><loyaltyConversionFactor>0</loyaltyConversionFactor><loyaltyPointsCredit>0</loyaltyPointsCredit><loyaltyPointsUsed>0</loyaltyPointsUsed><mrpTotal>799</mrpTotal><notes></notes><onHold>false</onHold><orderProcessingFlowMode>OMS</orderProcessingFlowMode><orderReleases><orderRelease><createdBy>end2endautomation1@gmail.com</createdBy><createdOn>2016-02-29T12:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":19+05:30</createdOn><id>70042952</id><lastModifiedOn>2016-02-29T13:35:24+05:30</lastModifiedOn><version>10</version><address>Myntra Design, AKR B</address><addressId>6118982</addressId><cartDiscount>0</cartDiscount><cashRedeemed>0</cashRedeemed><city>Bangalore</city><codCharge>0</codCharge><codPaymentStatus>pending</codPaymentStatus><country>India</country><couponDiscount>0</couponDiscount><courierCode>ML</courierCode><courierDisplayName>Myntra Logistics</courierDisplayName><customerPromiseTime>2016-03-04T23:01:02+05:30</customerPromiseTime><discount>0</discount><earnedCredit>0</earnedCredit><email>8861d0a4.f190.4a91.b392.965c152b3914CLcZYByF9R</email><emiCharge>0</emiCharge><expectedCutoffTime>2016-02-29T23:01:02+05:30</expectedCutoffTime><expectedDeliveryPromise>2016-03-04T23:01:02+05:30</expectedDeliveryPromise><expectedPackingTime>2016-02-29T23:00:24+05:30</expectedPackingTime><expectedPickingTime>2016-02-29T21:00:24+05:30</expectedPickingTime><expectedQCTime>2016-02-29T21:00:24+05:30</expectedQCTime><finalAmount>801</finalAmount><gift>false</gift><giftCardAmount>0</giftCardAmount><giftCharge>0</giftCharge><locality>Bommanahalli  &#x28;Bangalore&#x29;</locality><login>end2endautomation1@gmail.com</login><loyaltyConversionFactor>0</loyaltyConversionFactor><loyaltyPointsCredit>0</loyaltyPointsCredit><loyaltyPointsUsed>0</loyaltyPointsUsed><mobile>9439543863</mobile><mrpTotal>799</mrpTotal><onHold>false</onHold><orderId>70042952</orderId><orderLines><orderLine><createdBy>end2endautomation1@gmail.com</createdBy><createdOn>2016-02-29T12:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":19+05:30</createdOn><id>52700694</id><lastModifiedOn>2016-02-29T13:32:46+05:30</lastModifiedOn><version>3</version><cartDiscount>0</cartDiscount><cashRedeemed>0</cashRedeemed><cashbackOffered>0</cashbackOffered><couponDiscount>0</couponDiscount><customizedMessage></customizedMessage><discount>0</discount><discountRuleId>0</discountRuleId><discountRuleRevId>0</discountRuleRevId><discountedProduct>false</discountedProduct><discountedQuantity>0</discountedQuantity><earnedCredit>0</earnedCredit><finalAmount>799</finalAmount><fragile>false</fragile><giftCardAmount>0</giftCardAmount><govtTaxAmount>39.95</govtTaxAmount><govtTaxRate>5.25</govtTaxRate><govtTaxType>CST</govtTaxType><govtTaxableAmount>761.05</govtTaxableAmount><hazMat>false</hazMat><isCustomizable>false</isCustomizable><isDiscountedProduct>false</isDiscountedProduct><isExchangeableProduct>true</isExchangeableProduct><isFragile>false</isFragile><isHazMat>false</isHazMat><isJewellery>false</isJewellery><isReturnableProduct>true</isReturnableProduct><jewellery>false</jewellery><loyaltyConversionFactor>0</loyaltyConversionFactor><loyaltyPointsAwarded>0</loyaltyPointsAwarded><loyaltyPointsCredit>0</loyaltyPointsCredit><loyaltyPointsUsed>0</loyaltyPointsUsed><optionId>4853</optionId><orderId>70042952</orderId><orderReleaseId>70042952</orderReleaseId><packagingStatus>NOT_PACKAGED</packagingStatus><packagingType>NORMAL</packagingType><pgDiscount>0</pgDiscount><poStatus>UNUSED</poStatus><quantity>1</quantity><sellerId>21</sellerId><skuId>3832</skuId><status>PK</status><statusDisplayName>QA Done</statusDisplayName><storedCredit>0</storedCredit><styleId>1531</styleId><supplyType>ON_HAND</supplyType><taxAmount>0</taxAmount><taxRate>5.5</taxRate><unitPrice>799</unitPrice></orderLine></orderLines><packedOn>2016-02-29T13:35:24+05:30</packedOn><paymentMethod>on</paymentMethod><paymentMethodDisplay>Online</paymentMethodDisplay><personalized>false</personalized><pgDiscount>0</pgDiscount><queuedOn>2016-02-29T12:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":24+05:30</queuedOn><receiverName>END2END Automation1 </receiverName><refunded>false</refunded><sellerProcessingEndTime>2016-03-02T17:07:25+05:30</sellerProcessingEndTime><sellerProcessingStartTime>2016-02-29T12:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":25+05:30</sellerProcessingStartTime><shippingCharge>2</shippingCharge><shippingMethod>NORMAL</shippingMethod><singleItemRelease>false</singleItemRelease><specialPincode>false</specialPincode><state>KA</state><status>PK</status><statusDisplayName>Packed</statusDisplayName><storeId>1</storeId><storedCredit>0</storedCredit><taxAmount>0</taxAmount><trackingNo>ML0008941697</trackingNo><userContactNo>9439543863</userContactNo><warehouseId>28</warehouseId><zipcode>560068</zipcode></orderRelease></orderReleases><orderType>on</orderType><orderTypeDisplay>Online</orderTypeDisplay><paymentMethod>on</paymentMethod><paymentMethodDisplay>Online</paymentMethodDisplay><paymentPpsId>a3fb8404-1ee2-40e1-b272-dca183381418</paymentPpsId><pgDiscount>0</pgDiscount><queuedOn>2016-02-29T12:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":24+05:30</queuedOn><shippingCharge>2</shippingCharge><storeId>1</storeId><storedCredit>0</storedCredit><taxAmount>0</taxAmount><totalOrderValue>801</totalOrderValue><userContactNo>9439543863</userContactNo></order>";
		String payment_Plan_70042952 = "INSERT INTO `payment_plan` (`id`, `comments`, `updatedBy`, `updatedTimestamp`, `actionType`, `clientTransactionId`, `crmRefId`, `login`, `orderId`, `ppsType`, `sourceId`, `state`, `sessionId`, `cartContext`, `totalAmount`, `mobile`, `returnId`, `userAgent`, `clientIP`, `bankAccountId`) VALUES ('a3fb8404-1ee2-40e1-b272-dca183381418', 'PPS Plan created', 'SYSTEM', 1456728558921, 'SALE', NULL, NULL, 'end2endautomation1@gmail.com', '70042952', 'ORDER', '1ecaadd1-0f40-4b6e-baec-77ea8b9dae71--s3', 'PPFSM Order Taking done', 'JJN001ce88a2cd78594db585da2a65f809db271456728487M', 'DEFAULT', 80100, NULL, NULL, NULL, '1.1.1.1', NULL);";
		String payment_plan_item_70042952 = "INSERT INTO `payment_plan_item` (`id`, `comments`, `updatedBy`, `updatedTimestamp`, `itemType`, `pricePerUnit`, `quantity`, `sellerId`, `skuId`, `pps_Id`) VALUES (99942170, 'Payment Plan Item created', 'SYSTEM', 1456728559076, 'SKU', 79900, 1, '1', '3832', 'a3fb8404-1ee2-40e1-b272-dca183381418'), (99942171, 'Payment Plan Item created', 'SYSTEM', 1456728559076, 'SHIPPING_CHARGES', 200, 1, '1', 'PPS_9999', 'a3fb8404-1ee2-40e1-b272-dca183381418');";
		String payment_plan_item_instrument_70042952 = "INSERT INTO `payment_plan_item_instrument` (`id`, `comments`, `updatedBy`, `updatedTimestamp`, `amount`, `paymentInstrumentType`, `ppsItemId`, `actionType`) VALUES (31532, 'Payment Plan Item Instrument Detail created', 'SYSTEM', 1456728559077, 79900, 5, 99942170, NULL), (31533, 'Payment Plan Item Instrument Detail created', 'SYSTEM', 1456728559077, 200, 5, 99942171, NULL);";
		String payment_plan_instrument_Details_70042952 = "INSERT INTO `payment_plan_instrument_details` (`id`, `comments`, `updatedBy`, `updatedTimestamp`, `paymentInstrumentType`, `totalPrice`, `pps_Id`, `paymentPlanExecutionStatus_id`, `actionType`, `parentInstrumentDetailId`) VALUES(21931, 'PPS Plan Instrument Details created', 'SYSTEM', 1456728559076, 5, 80100, 'a3fb8404-1ee2-40e1-b272-dca183381418', 9862055, 'DEBIT', NULL);";

		omsServiceHelper.deletePPSRecords("'a3fb8404-1ee2-40e1-b272-dca183381418'");
		omsServiceHelper.deleteOMSDBEntriesForOrderID("70042952");
		omsServiceHelper.chnageOlderOrdersToOnlineForCODTesting(uidx,login);
		DBUtilities.exUpdateQuery(payment_Plan_70042952, "pps");
		DBUtilities.exUpdateQuery(payment_plan_item_70042952, "pps");
		DBUtilities.exUpdateQuery(payment_plan_item_instrument_70042952, "pps");
		DBUtilities.exUpdateQuery(payment_plan_instrument_Details_70042952, "pps");
		omsServiceHelper.createOrderInOMS(order_pps_70042952);

		Object[][] dataSet = new Object[][] { { "70042952", login } };
		return Toolbox.returnReducedDataSet(dataSet, testContext.getIncludedGroups(), 11, 11);
	}
	
	@DataProvider(name = "cancelReleaseOfASHippedOrderDP")
	public static Object[][] cancelReleaseOfASHippedOrderDP(ITestContext testContext)
			throws SQLException, UnsupportedEncodingException, JAXBException {
		String order_pps_70042952 = "<order><createdBy>end2endautomation1@gmail.com</createdBy><createdOn>2016-02-29T12:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":19+05:30</createdOn><id>70042952</id><lastModifiedOn>2016-02-29T13:14:15+05:30</lastModifiedOn><version>3</version><billingAddress><createdBy>pps-admin</createdBy><createdOn>2016-02-29T13:15:10+05:30</createdOn><id>1547</id><lastModifiedOn>2016-02-29T13:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":54+05:30</lastModifiedOn><version>0</version><billingAddress></billingAddress><billingCity></billingCity><billingCounty></billingCounty><billingEmail>end2endautomation1@gmail.com</billingEmail><billingFirstName></billingFirstName><billingLastName></billingLastName><billingMobile>9439543863</billingMobile><billingState></billingState><billingZipCode></billingZipCode></billingAddress><cartDiscount>0</cartDiscount><cashBackCouponCode></cashBackCouponCode><cashRedeemed>0</cashRedeemed><cashbackOffered>0</cashbackOffered><channel>web</channel><codCharge>0</codCharge><couponCode></couponCode><couponDiscount>0</couponDiscount><customerName>END2END Automation1</customerName><discount>0</discount><earnedCredit>0</earnedCredit><emiCharge>0</emiCharge><finalAmount>801</finalAmount><giftCardAmount>0</giftCardAmount><giftCharge>0</giftCharge><giftOrder>false</giftOrder><login>end2endautomation1@gmail.com</login><loyaltyConversionFactor>0</loyaltyConversionFactor><loyaltyPointsCredit>0</loyaltyPointsCredit><loyaltyPointsUsed>0</loyaltyPointsUsed><mrpTotal>799</mrpTotal><notes></notes><onHold>false</onHold><orderProcessingFlowMode>OMS</orderProcessingFlowMode><orderReleases><orderRelease><createdBy>end2endautomation1@gmail.com</createdBy><createdOn>2016-02-29T12:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":19+05:30</createdOn><id>70042952</id><lastModifiedOn>2016-02-29T13:35:24+05:30</lastModifiedOn><version>10</version><address>Myntra Design, AKR B</address><addressId>6118982</addressId><cartDiscount>0</cartDiscount><cashRedeemed>0</cashRedeemed><city>Bangalore</city><codCharge>0</codCharge><codPaymentStatus>pending</codPaymentStatus><country>India</country><couponDiscount>0</couponDiscount><courierCode>ML</courierCode><courierDisplayName>Myntra Logistics</courierDisplayName><customerPromiseTime>2016-03-04T23:01:02+05:30</customerPromiseTime><discount>0</discount><earnedCredit>0</earnedCredit><email>8861d0a4.f190.4a91.b392.965c152b3914CLcZYByF9R</email><emiCharge>0</emiCharge><expectedCutoffTime>2016-02-29T23:01:02+05:30</expectedCutoffTime><expectedDeliveryPromise>2016-03-04T23:01:02+05:30</expectedDeliveryPromise><expectedPackingTime>2016-02-29T23:00:24+05:30</expectedPackingTime><expectedPickingTime>2016-02-29T21:00:24+05:30</expectedPickingTime><expectedQCTime>2016-02-29T21:00:24+05:30</expectedQCTime><finalAmount>801</finalAmount><gift>false</gift><giftCardAmount>0</giftCardAmount><giftCharge>0</giftCharge><locality>Bommanahalli  &#x28;Bangalore&#x29;</locality><login>end2endautomation1@gmail.com</login><loyaltyConversionFactor>0</loyaltyConversionFactor><loyaltyPointsCredit>0</loyaltyPointsCredit><loyaltyPointsUsed>0</loyaltyPointsUsed><mobile>9439543863</mobile><mrpTotal>799</mrpTotal><onHold>false</onHold><orderId>70042952</orderId><orderLines><orderLine><createdBy>end2endautomation1@gmail.com</createdBy><createdOn>2016-02-29T12:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":19+05:30</createdOn><id>52700694</id><lastModifiedOn>2016-02-29T13:32:46+05:30</lastModifiedOn><version>3</version><cartDiscount>0</cartDiscount><cashRedeemed>0</cashRedeemed><cashbackOffered>0</cashbackOffered><couponDiscount>0</couponDiscount><customizedMessage></customizedMessage><discount>0</discount><discountRuleId>0</discountRuleId><discountRuleRevId>0</discountRuleRevId><discountedProduct>false</discountedProduct><discountedQuantity>0</discountedQuantity><earnedCredit>0</earnedCredit><finalAmount>799</finalAmount><fragile>false</fragile><giftCardAmount>0</giftCardAmount><govtTaxAmount>39.95</govtTaxAmount><govtTaxRate>5.25</govtTaxRate><govtTaxType>CST</govtTaxType><govtTaxableAmount>761.05</govtTaxableAmount><hazMat>false</hazMat><isCustomizable>false</isCustomizable><isDiscountedProduct>false</isDiscountedProduct><isExchangeableProduct>true</isExchangeableProduct><isFragile>false</isFragile><isHazMat>false</isHazMat><isJewellery>false</isJewellery><isReturnableProduct>true</isReturnableProduct><jewellery>false</jewellery><loyaltyConversionFactor>0</loyaltyConversionFactor><loyaltyPointsAwarded>0</loyaltyPointsAwarded><loyaltyPointsCredit>0</loyaltyPointsCredit><loyaltyPointsUsed>0</loyaltyPointsUsed><optionId>4853</optionId><orderId>70042952</orderId><orderReleaseId>70042952</orderReleaseId><packagingStatus>NOT_PACKAGED</packagingStatus><packagingType>NORMAL</packagingType><pgDiscount>0</pgDiscount><poStatus>UNUSED</poStatus><quantity>1</quantity><sellerId>21</sellerId><skuId>3832</skuId><status>S</status><statusDisplayName>QA Done</statusDisplayName><storedCredit>0</storedCredit><styleId>1531</styleId><supplyType>ON_HAND</supplyType><taxAmount>0</taxAmount><taxRate>5.5</taxRate><unitPrice>799</unitPrice></orderLine></orderLines><packedOn>2016-02-29T13:35:24+05:30</packedOn><paymentMethod>on</paymentMethod><paymentMethodDisplay>Online</paymentMethodDisplay><personalized>false</personalized><pgDiscount>0</pgDiscount><queuedOn>2016-02-29T12:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":24+05:30</queuedOn><receiverName>END2END Automation1 </receiverName><refunded>false</refunded><sellerProcessingEndTime>2016-03-02T17:07:25+05:30</sellerProcessingEndTime><sellerProcessingStartTime>2016-02-29T12:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":25+05:30</sellerProcessingStartTime><shippingCharge>2</shippingCharge><shippingMethod>NORMAL</shippingMethod><singleItemRelease>false</singleItemRelease><specialPincode>false</specialPincode><state>KA</state><status>SH</status><statusDisplayName>Packed</statusDisplayName><storeId>1</storeId><storedCredit>0</storedCredit><taxAmount>0</taxAmount><trackingNo>ML0008941697</trackingNo><userContactNo>9439543863</userContactNo><warehouseId>28</warehouseId><zipcode>560068</zipcode></orderRelease></orderReleases><orderType>on</orderType><orderTypeDisplay>Online</orderTypeDisplay><paymentMethod>on</paymentMethod><paymentMethodDisplay>Online</paymentMethodDisplay><paymentPpsId>a3fb8404-1ee2-40e1-b272-dca183381418</paymentPpsId><pgDiscount>0</pgDiscount><queuedOn>2016-02-29T12:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":24+05:30</queuedOn><shippingCharge>2</shippingCharge><storeId>1</storeId><storedCredit>0</storedCredit><taxAmount>0</taxAmount><totalOrderValue>801</totalOrderValue><userContactNo>9439543863</userContactNo></order>";
		String payment_Plan_70042952 = "INSERT INTO `payment_plan` (`id`, `comments`, `updatedBy`, `updatedTimestamp`, `actionType`, `clientTransactionId`, `crmRefId`, `login`, `orderId`, `ppsType`, `sourceId`, `state`, `sessionId`, `cartContext`, `totalAmount`, `mobile`, `returnId`, `userAgent`, `clientIP`, `bankAccountId`) VALUES ('a3fb8404-1ee2-40e1-b272-dca183381418', 'PPS Plan created', 'SYSTEM', 1456728558921, 'SALE', NULL, NULL, 'end2endautomation1@gmail.com', '70042952', 'ORDER', '1ecaadd1-0f40-4b6e-baec-77ea8b9dae71--s3', 'PPFSM Order Taking done', 'JJN001ce88a2cd78594db585da2a65f809db271456728487M', 'DEFAULT', 80100, NULL, NULL, NULL, '1.1.1.1', NULL);";
		String payment_plan_item_70042952 = "INSERT INTO `payment_plan_item` (`id`, `comments`, `updatedBy`, `updatedTimestamp`, `itemType`, `pricePerUnit`, `quantity`, `sellerId`, `skuId`, `pps_Id`) VALUES (99942170, 'Payment Plan Item created', 'SYSTEM', 1456728559076, 'SKU', 79900, 1, '1', '3832', 'a3fb8404-1ee2-40e1-b272-dca183381418'), (99942171, 'Payment Plan Item created', 'SYSTEM', 1456728559076, 'SHIPPING_CHARGES', 200, 1, '1', 'PPS_9999', 'a3fb8404-1ee2-40e1-b272-dca183381418');";
		String payment_plan_item_instrument_70042952 = "INSERT INTO `payment_plan_item_instrument` (`id`, `comments`, `updatedBy`, `updatedTimestamp`, `amount`, `paymentInstrumentType`, `ppsItemId`, `actionType`) VALUES (31532, 'Payment Plan Item Instrument Detail created', 'SYSTEM', 1456728559077, 79900, 5, 99942170, NULL), (31533, 'Payment Plan Item Instrument Detail created', 'SYSTEM', 1456728559077, 200, 5, 99942171, NULL);";
		String payment_plan_instrument_Details_70042952 = "INSERT INTO `payment_plan_instrument_details` (`id`, `comments`, `updatedBy`, `updatedTimestamp`, `paymentInstrumentType`, `totalPrice`, `pps_Id`, `paymentPlanExecutionStatus_id`, `actionType`, `parentInstrumentDetailId`) VALUES(21931, 'PPS Plan Instrument Details created', 'SYSTEM', 1456728559076, 5, 80100, 'a3fb8404-1ee2-40e1-b272-dca183381418', 9862055, 'DEBIT', NULL);";

		omsServiceHelper.deletePPSRecords("'a3fb8404-1ee2-40e1-b272-dca183381418'");
		omsServiceHelper.deleteOMSDBEntriesForOrderID("70042952");
		omsServiceHelper.chnageOlderOrdersToOnlineForCODTesting(uidx,login);
		DBUtilities.exUpdateQuery(payment_Plan_70042952, "pps");
		DBUtilities.exUpdateQuery(payment_plan_item_70042952, "pps");
		DBUtilities.exUpdateQuery(payment_plan_item_instrument_70042952, "pps");
		DBUtilities.exUpdateQuery(payment_plan_instrument_Details_70042952, "pps");
		omsServiceHelper.createOrderInOMS(order_pps_70042952);

		Object[][] dataSet = new Object[][] { { "70042952", login } };
		return Toolbox.returnReducedDataSet(dataSet, testContext.getIncludedGroups(), 11, 11);
	}

	@DataProvider(name = "checkReleaseCancellationOfACancelledOrderDP")
	public static Object[][] checkReleaseCancellationOfACancelledOrderDP(ITestContext testContext)
			throws SQLException, UnsupportedEncodingException, JAXBException {
		// # Create Order in OMS DB
		String order_pps_70041629 = "<order><createdBy>8861d0a4.f190.4a91.b392.965c152b3914CLcZYByF9R</createdBy><createdOn>2016-02-15T00:08:44+05:30</createdOn><id>70041629</id><lastModifiedOn>2016-02-18T13:12:44+05:30</lastModifiedOn><version>1</version><billingAddress><createdBy>pps-admin</createdBy><createdOn>2016-02-15T00:08:44+05:30</createdOn><id>234</id><lastModifiedOn>2016-02-15T00:08:44+05:30</lastModifiedOn><version>0</version><billingAddress></billingAddress><billingCity></billingCity><billingCounty></billingCounty><billingEmail>8861d0a4.f190.4a91.b392.965c152b3914CLcZYByF9R</billingEmail><billingFirstName></billingFirstName><billingLastName></billingLastName><billingMobile>9439543863</billingMobile><billingState></billingState><billingZipCode></billingZipCode></billingAddress><cartDiscount>0</cartDiscount><cashBackCouponCode></cashBackCouponCode><cashRedeemed>0</cashRedeemed><cashbackOffered>0</cashbackOffered><channel>web</channel><codCharge>0</codCharge><couponCode></couponCode><couponDiscount>0</couponDiscount><customerName>END2END Automation1</customerName><discount>0</discount><earnedCredit>0</earnedCredit><emiCharge>0</emiCharge><finalAmount>801</finalAmount><giftCardAmount>0</giftCardAmount><giftCharge>0</giftCharge><giftOrder>false</giftOrder><login>8861d0a4.f190.4a91.b392.965c152b3914CLcZYByF9R</login><loyaltyConversionFactor>0</loyaltyConversionFactor><loyaltyPointsCredit>0</loyaltyPointsCredit><loyaltyPointsUsed>0</loyaltyPointsUsed><mrpTotal>799</mrpTotal><notes></notes><onHold>false</onHold><orderProcessingFlowMode>OMS</orderProcessingFlowMode><orderReleases><orderRelease><createdBy>8861d0a4.f190.4a91.b392.965c152b3914CLcZYByF9R</createdBy><createdOn>2016-02-15T00:08:44+05:30</createdOn><id>70041629</id><lastModifiedOn>2016-02-18T13:26:32+05:30</lastModifiedOn><version>3</version><address>Myntra Design, AKR B</address><addressId>6118982</addressId><cancellationPpsId>f3d6506c-2fe9-49ef-9189-7a1e7cbb38be</cancellationPpsId><cancellationReason>CC Cancellation - OOS Cancellation</cancellationReason><cancellationReasonId>1</cancellationReasonId><cancelledOn>2016-02-18T13:26:31+05:30</cancelledOn><cartDiscount>0</cartDiscount><cashRedeemed>0</cashRedeemed><city>Bangalore</city><codCharge>0</codCharge><codPaymentStatus>pending</codPaymentStatus><country>India</country><couponDiscount>0</couponDiscount><courierCode>ML</courierCode><courierDisplayName>Myntra Logistics</courierDisplayName><customerPromiseTime>2016-02-18T22:01:02+05:30</customerPromiseTime><discount>0</discount><earnedCredit>0</earnedCredit><email>8861d0a4.f190.4a91.b392.965c152b3914CLcZYByF9R</email><emiCharge>0</emiCharge><expectedCutoffTime>2016-02-15T22:01:02+05:30</expectedCutoffTime><expectedDeliveryPromise>2016-02-18T22:01:02+05:30</expectedDeliveryPromise><expectedPackingTime>2016-02-15T20:00:49+05:30</expectedPackingTime><expectedPickingTime>2016-02-15T20:00:49+05:30</expectedPickingTime><expectedQCTime>2016-02-15T20:00:49+05:30</expectedQCTime><finalAmount>801</finalAmount><gift>false</gift><giftCardAmount>0</giftCardAmount><giftCharge>0</giftCharge><locality>Bommanahalli  (Bangalore)</locality><login>8861d0a4.f190.4a91.b392.965c152b3914CLcZYByF9R</login><loyaltyConversionFactor>0</loyaltyConversionFactor><loyaltyPointsCredit>0</loyaltyPointsCredit><loyaltyPointsUsed>0</loyaltyPointsUsed><mobile>9439543863</mobile><mrpTotal>799</mrpTotal><onHold>false</onHold><orderId>70041629</orderId><orderLines><orderLine><createdBy>8861d0a4.f190.4a91.b392.965c152b3914CLcZYByF9R</createdBy><createdOn>2016-02-15T00:08:44+05:30</createdOn><id>52698240</id><lastModifiedOn>2016-02-18T13:12:44+05:30</lastModifiedOn><version>1</version><cartDiscount>0</cartDiscount><cashRedeemed>0</cashRedeemed><cashbackOffered>0</cashbackOffered><couponDiscount>0</couponDiscount><customizedMessage></customizedMessage><discount>0</discount><discountRuleId>0</discountRuleId><discountRuleRevId>0</discountRuleRevId><discountedProduct>false</discountedProduct><discountedQuantity>0</discountedQuantity><earnedCredit>0</earnedCredit><finalAmount>799</finalAmount><fragile>false</fragile><giftCardAmount>0</giftCardAmount><govtTaxAmount>0</govtTaxAmount><govtTaxRate>5.5</govtTaxRate><hazMat>false</hazMat><isCustomizable>false</isCustomizable><isDiscountedProduct>false</isDiscountedProduct><isExchangeableProduct>true</isExchangeableProduct><isFragile>false</isFragile><isHazMat>false</isHazMat><isJewellery>false</isJewellery><isReturnableProduct>true</isReturnableProduct><jewellery>false</jewellery><loyaltyConversionFactor>0</loyaltyConversionFactor><loyaltyPointsAwarded>0</loyaltyPointsAwarded><loyaltyPointsCredit>0</loyaltyPointsCredit><loyaltyPointsUsed>0</loyaltyPointsUsed><optionId>4852</optionId><orderId>70041629</orderId><orderReleaseId>70041629</orderReleaseId><packagingStatus>NOT_PACKAGED</packagingStatus><packagingType>NORMAL</packagingType><pgDiscount>0</pgDiscount><poStatus>UNUSED</poStatus><quantity>1</quantity><sellerId>21</sellerId><skuId>3831</skuId><status>A</status><statusDisplayName>Assigned</statusDisplayName><storedCredit>0</storedCredit><styleId>1531</styleId><supplyType>ON_HAND</supplyType><taxAmount>0</taxAmount><taxRate>5.5</taxRate><unitPrice>799</unitPrice></orderLine></orderLines><paymentMethod>cod</paymentMethod><paymentMethodDisplay>Cash On Delivery</paymentMethodDisplay><personalized>false</personalized><pgDiscount>0</pgDiscount><queuedOn>2016-02-15T00:08:49+05:30</queuedOn><receiverName>END2END Automation1 </receiverName><refunded>false</refunded><sellerProcessingEndTime>2016-02-17T04:56:49+05:30</sellerProcessingEndTime><sellerProcessingStartTime>2016-02-15T00:08:49+05:30</sellerProcessingStartTime><shippingCharge>2</shippingCharge><shippingMethod>NORMAL</shippingMethod><singleItemRelease>false</singleItemRelease><specialPincode>false</specialPincode><state>KA</state><status>F</status><statusDisplayName>Cancelled</statusDisplayName><storeId>1</storeId><storedCredit>0</storedCredit><taxAmount>0</taxAmount><trackingNo>ML0008926156</trackingNo><userContactNo>9439543863</userContactNo><warehouseId>36</warehouseId><zipcode>560068</zipcode></orderRelease></orderReleases><orderType>on</orderType><orderTypeDisplay>Online</orderTypeDisplay><paymentMethod>cod</paymentMethod><paymentMethodDisplay>Cash On Delivery</paymentMethodDisplay><paymentPpsId>57027205-a93c-45cf-beca-794aa66e928b</paymentPpsId><pgDiscount>0</pgDiscount><queuedOn>2016-02-15T00:08:49+05:30</queuedOn><shippingCharge>2</shippingCharge><storeId>1</storeId><storedCredit>0</storedCredit><taxAmount>0</taxAmount><totalOrderValue>801</totalOrderValue><userContactNo>9439543863</userContactNo></order>";
		
		// # Insert into PPS DB
		String payment_Plan = "INSERT INTO `payment_plan` (`id`, `comments`, `updatedBy`, `updatedTimestamp`, `actionType`, `clientTransactionId`, `crmRefId`, `login`, `orderId`, `ppsType`, `sourceId`, `state`, `sessionId`, `cartContext`, `totalAmount`, `mobile`, `returnId`, `userAgent`, `clientIP`) VALUES ('57027205-a93c-45cf-beca-794aa66e928b', 'PPS Plan created', 'SYSTEM', 1455475123554, 'SALE', NULL, NULL, '8861d0a4.f190.4a91.b392.965c152b3914CLcZYByF9R', '70041629', 'ORDER', '7ab30162-d9af-4331-b882-56b77b6346d2--s3', 'PPFSM Order Taking done', 'JJN00410ae414c2049408ba76c45437d8968bf1455475051M', 'DEFAULT', 80100, NULL, NULL, NULL, '1.1.1.1'), ('f3d6506c-2fe9-49ef-9189-7a1e7cbb38be', 'PPS Plan created', 'SYSTEM', 1455601851329, 'CANCELLATION', 'RELEASE_CANCELLATION_REFUND70041629', NULL, '8861d0a4.f190.4a91.b392.965c152b3914CLcZYByF9R', '70041629', 'ORDER', '57027205-a93c-45cf-beca-794aa66e928b', 'PPFSM Refund done', NULL, NULL, NULL, NULL, NULL, NULL, NULL);";
		String payment_plan_item = "INSERT INTO `payment_plan_item` (`id`, `comments`, `updatedBy`, `updatedTimestamp`, `itemType`, `pricePerUnit`, `quantity`, `sellerId`, `skuId`, `pps_Id`) VALUES (99941086, 'Payment Plan Item created', 'SYSTEM', 1455475123839, 'SHIPPING_CHARGES', 200, 1, '1', 'PPS_9999', '57027205-a93c-45cf-beca-794aa66e928b'), (99941087, 'Payment Plan Item created', 'SYSTEM', 1455475123839, 'SKU', 79900, 1, '1', '3831', '57027205-a93c-45cf-beca-794aa66e928b'), (99941127, 'Payment Plan Refund Item created', 'SYSTEM', 1455601851455, 'SHIPPING_CHARGES', 200, 1, '1', 'PPS_9999', 'f3d6506c-2fe9-49ef-9189-7a1e7cbb38be'), (99941128, 'Payment Plan Refund Item created', 'SYSTEM', 1455601851408, 'SKU', 79900, 1, '1', '3831', 'f3d6506c-2fe9-49ef-9189-7a1e7cbb38be');";
		String payment_plan_item_instrument = "INSERT INTO `payment_plan_item_instrument` (`id`, `comments`, `updatedBy`, `updatedTimestamp`, `amount`, `paymentInstrumentType`, `ppsItemId`, `actionType`) VALUES (27579, 'Payment Plan Item Instrument Detail created', 'SYSTEM', 1455475123840, 200, 5, 99941086, NULL), (27580, 'Payment Plan Item Instrument Detail created', 'SYSTEM', 1455475123840, 79900, 5, 99941087, NULL), (27818, NULL, 'SYSTEM', 1455601851471, 200, 5, 99941127, 'REFUND'), (27819, NULL, 'SYSTEM', 1455601851423, 79900, 5, 99941128, 'REFUND');";
		String payment_plan_instrument_Details = "INSERT INTO `payment_plan_instrument_details` (`id`, `comments`, `updatedBy`, `updatedTimestamp`, `paymentInstrumentType`, `totalPrice`, `pps_Id`, `paymentPlanExecutionStatus_id`, `actionType`, `parentInstrumentDetailId`) VALUES  (19332, 'PPS Plan Instrument Details created', 'SYSTEM', 1455475123839, 5, 80100, '57027205-a93c-45cf-beca-794aa66e928b', 9182452, 'DEBIT', NULL), (19488, 'PPS Plan Instrument Details created', 'SYSTEM', 1455601851800, 5, 80100, 'f3d6506c-2fe9-49ef-9189-7a1e7cbb38be', 9182476, 'REFUND', NULL);";

		omsServiceHelper.deletePPSRecords("'57027205-a93c-45cf-beca-794aa66e928b','f3d6506c-2fe9-49ef-9189-7a1e7cbb38be'");
		omsServiceHelper.deleteOMSDBEntriesForOrderID("70041629");
		omsServiceHelper.chnageOlderOrdersToOnlineForCODTesting(uidx,login);

		DBUtilities.exUpdateQuery(payment_Plan, "pps");
		DBUtilities.exUpdateQuery(payment_plan_item, "pps");
		DBUtilities.exUpdateQuery(payment_plan_item_instrument, "pps");
		DBUtilities.exUpdateQuery(payment_plan_instrument_Details, "pps");

		omsServiceHelper.createOrderInOMS(order_pps_70041629);

		Object[][] dataSet = new Object[][] { { "70041629", login} };
		return Toolbox.returnReducedDataSet(dataSet, testContext.getIncludedGroups(), 11, 11);
	}

	@DataProvider(name = "checkReleaseCancellationOfAnOrderWithLineAsQDDP")
	public static Object[][] checkReleaseCancellationOfAnOrderWithLineAsQDDP(ITestContext testContext)
			throws SQLException, UnsupportedEncodingException, JAXBException {
		String order_pps_70042952 = "<order><createdBy>end2endautomation1@gmail.com</createdBy><createdOn>2016-02-29T12:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":19+05:30</createdOn><id>70042952</id><lastModifiedOn>2016-02-29T13:14:15+05:30</lastModifiedOn><version>3</version><billingAddress><createdBy>pps-admin</createdBy><createdOn>2016-02-29T13:15:10+05:30</createdOn><id>1547</id><lastModifiedOn>2016-02-29T13:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":54+05:30</lastModifiedOn><version>0</version><billingAddress></billingAddress><billingCity></billingCity><billingCounty></billingCounty><billingEmail>end2endautomation1@gmail.com</billingEmail><billingFirstName></billingFirstName><billingLastName></billingLastName><billingMobile>9439543863</billingMobile><billingState></billingState><billingZipCode></billingZipCode></billingAddress><cartDiscount>0</cartDiscount><cashBackCouponCode></cashBackCouponCode><cashRedeemed>0</cashRedeemed><cashbackOffered>0</cashbackOffered><channel>web</channel><codCharge>0</codCharge><couponCode></couponCode><couponDiscount>0</couponDiscount><customerName>END2END Automation1</customerName><discount>0</discount><earnedCredit>0</earnedCredit><emiCharge>0</emiCharge><finalAmount>801</finalAmount><giftCardAmount>0</giftCardAmount><giftCharge>0</giftCharge><giftOrder>false</giftOrder><login>end2endautomation1@gmail.com</login><loyaltyConversionFactor>0</loyaltyConversionFactor><loyaltyPointsCredit>0</loyaltyPointsCredit><loyaltyPointsUsed>0</loyaltyPointsUsed><mrpTotal>799</mrpTotal><notes></notes><onHold>false</onHold><orderProcessingFlowMode>OMS</orderProcessingFlowMode><orderReleases><orderRelease><createdBy>end2endautomation1@gmail.com</createdBy><createdOn>2016-02-29T12:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":19+05:30</createdOn><id>70042952</id><lastModifiedOn>2016-02-29T13:14:15+05:30</lastModifiedOn><version>9</version><address>Myntra Design, AKR B</address><addressId>6118982</addressId><cartDiscount>0</cartDiscount><cashRedeemed>0</cashRedeemed><city>Bangalore</city><codCharge>0</codCharge><codPaymentStatus>pending</codPaymentStatus><country>India</country><couponDiscount>0</couponDiscount><courierCode>ML</courierCode><courierDisplayName>Myntra Logistics</courierDisplayName><customerPromiseTime>2016-03-04T23:01:02+05:30</customerPromiseTime><discount>0</discount><earnedCredit>0</earnedCredit><email>8861d0a4.f190.4a91.b392.965c152b3914CLcZYByF9R</email><emiCharge>0</emiCharge><expectedCutoffTime>2016-02-29T23:01:02+05:30</expectedCutoffTime><expectedDeliveryPromise>2016-03-04T23:01:02+05:30</expectedDeliveryPromise><expectedPackingTime>2016-02-29T23:00:24+05:30</expectedPackingTime><expectedPickingTime>2016-02-29T21:00:24+05:30</expectedPickingTime><expectedQCTime>2016-02-29T21:00:24+05:30</expectedQCTime><finalAmount>801</finalAmount><gift>false</gift><giftCardAmount>0</giftCardAmount><giftCharge>0</giftCharge><locality>Bommanahalli  &#x28;Bangalore&#x29;</locality><login>end2endautomation1@gmail.com</login><loyaltyConversionFactor>0</loyaltyConversionFactor><loyaltyPointsCredit>0</loyaltyPointsCredit><loyaltyPointsUsed>0</loyaltyPointsUsed><mobile>9439543863</mobile><mrpTotal>799</mrpTotal><onHold>false</onHold><orderId>70042952</orderId><orderLines><orderLine><createdBy>end2endautomation1@gmail.com</createdBy><createdOn>2016-02-29T12:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":19+05:30</createdOn><id>52700694</id><lastModifiedOn>2016-02-29T13:32:46+05:30</lastModifiedOn><version>3</version><cartDiscount>0</cartDiscount><cashRedeemed>0</cashRedeemed><cashbackOffered>0</cashbackOffered><couponDiscount>0</couponDiscount><customizedMessage></customizedMessage><discount>0</discount><discountRuleId>0</discountRuleId><discountRuleRevId>0</discountRuleRevId><discountedProduct>false</discountedProduct><discountedQuantity>0</discountedQuantity><earnedCredit>0</earnedCredit><finalAmount>799</finalAmount><fragile>false</fragile><giftCardAmount>0</giftCardAmount><govtTaxAmount>39.95</govtTaxAmount><govtTaxRate>5.25</govtTaxRate><govtTaxType>CST</govtTaxType><govtTaxableAmount>761.05</govtTaxableAmount><hazMat>false</hazMat><isCustomizable>false</isCustomizable><isDiscountedProduct>false</isDiscountedProduct><isExchangeableProduct>true</isExchangeableProduct><isFragile>false</isFragile><isHazMat>false</isHazMat><isJewellery>false</isJewellery><isReturnableProduct>true</isReturnableProduct><jewellery>false</jewellery><loyaltyConversionFactor>0</loyaltyConversionFactor><loyaltyPointsAwarded>0</loyaltyPointsAwarded><loyaltyPointsCredit>0</loyaltyPointsCredit><loyaltyPointsUsed>0</loyaltyPointsUsed><optionId>4853</optionId><orderId>70042952</orderId><orderReleaseId>70042952</orderReleaseId><packagingStatus>NOT_PACKAGED</packagingStatus><packagingType>NORMAL</packagingType><pgDiscount>0</pgDiscount><poStatus>UNUSED</poStatus><quantity>1</quantity><sellerId>21</sellerId><skuId>3832</skuId><status>WP</status><statusDisplayName>QA Done</statusDisplayName><storedCredit>0</storedCredit><styleId>1531</styleId><supplyType>ON_HAND</supplyType><taxAmount>0</taxAmount><taxRate>5.5</taxRate><unitPrice>799</unitPrice></orderLine></orderLines><paymentMethod>on</paymentMethod><paymentMethodDisplay>Online</paymentMethodDisplay><personalized>false</personalized><pgDiscount>0</pgDiscount><queuedOn>2016-02-29T12:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":24+05:30</queuedOn><receiverName>END2END Automation1 </receiverName><refunded>false</refunded><sellerProcessingEndTime>2016-03-02T17:07:25+05:30</sellerProcessingEndTime><sellerProcessingStartTime>2016-02-29T12:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":25+05:30</sellerProcessingStartTime><shippingCharge>2</shippingCharge><shippingMethod>NORMAL</shippingMethod><singleItemRelease>false</singleItemRelease><specialPincode>false</specialPincode><state>KA</state><status>WP</status><statusDisplayName>Work in progress</statusDisplayName><storeId>1</storeId><storedCredit>0</storedCredit><taxAmount>0</taxAmount><trackingNo>ML0008941697</trackingNo><userContactNo>9439543863</userContactNo><warehouseId>28</warehouseId><zipcode>560068</zipcode></orderRelease></orderReleases><orderType>on</orderType><orderTypeDisplay>Online</orderTypeDisplay><paymentMethod>on</paymentMethod><paymentMethodDisplay>Online</paymentMethodDisplay><paymentPpsId>a3fb8404-1ee2-40e1-b272-dca183381418</paymentPpsId><pgDiscount>0</pgDiscount><queuedOn>2016-02-29T12:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":24+05:30</queuedOn><shippingCharge>2</shippingCharge><storeId>1</storeId><storedCredit>0</storedCredit><taxAmount>0</taxAmount><totalOrderValue>801</totalOrderValue><userContactNo>9439543863</userContactNo></order>";
		String payment_Plan_70042952 = "INSERT INTO `payment_plan` (`id`, `comments`, `updatedBy`, `updatedTimestamp`, `actionType`, `clientTransactionId`, `crmRefId`, `login`, `orderId`, `ppsType`, `sourceId`, `state`, `sessionId`, `cartContext`, `totalAmount`, `mobile`, `returnId`, `userAgent`, `clientIP`, `bankAccountId`) VALUES ('a3fb8404-1ee2-40e1-b272-dca183381418', 'PPS Plan created', 'SYSTEM', 1456728558921, 'SALE', NULL, NULL, 'end2endautomation1@gmail.com', '70042952', 'ORDER', '1ecaadd1-0f40-4b6e-baec-77ea8b9dae71--s3', 'PPFSM Order Taking done', 'JJN001ce88a2cd78594db585da2a65f809db271456728487M', 'DEFAULT', 80100, NULL, NULL, NULL, '1.1.1.1', NULL);";
		String payment_plan_item_70042952 = "INSERT INTO `payment_plan_item` (`id`, `comments`, `updatedBy`, `updatedTimestamp`, `itemType`, `pricePerUnit`, `quantity`, `sellerId`, `skuId`, `pps_Id`) VALUES (99942170, 'Payment Plan Item created', 'SYSTEM', 1456728559076, 'SKU', 79900, 1, '1', '3832', 'a3fb8404-1ee2-40e1-b272-dca183381418'), (99942171, 'Payment Plan Item created', 'SYSTEM', 1456728559076, 'SHIPPING_CHARGES', 200, 1, '1', 'PPS_9999', 'a3fb8404-1ee2-40e1-b272-dca183381418');";
		String payment_plan_item_instrument_70042952 = "INSERT INTO `payment_plan_item_instrument` (`id`, `comments`, `updatedBy`, `updatedTimestamp`, `amount`, `paymentInstrumentType`, `ppsItemId`, `actionType`) VALUES (31532, 'Payment Plan Item Instrument Detail created', 'SYSTEM', 1456728559077, 79900, 5, 99942170, NULL), (31533, 'Payment Plan Item Instrument Detail created', 'SYSTEM', 1456728559077, 200, 5, 99942171, NULL);";
		String payment_plan_instrument_Details_70042952 = "INSERT INTO `payment_plan_instrument_details` (`id`, `comments`, `updatedBy`, `updatedTimestamp`, `paymentInstrumentType`, `totalPrice`, `pps_Id`, `paymentPlanExecutionStatus_id`, `actionType`, `parentInstrumentDetailId`) VALUES(21931, 'PPS Plan Instrument Details created', 'SYSTEM', 1456728559076, 5, 80100, 'a3fb8404-1ee2-40e1-b272-dca183381418', 9862055, 'DEBIT', NULL);";

		omsServiceHelper.deletePPSRecords("'a3fb8404-1ee2-40e1-b272-dca183381418'");
		omsServiceHelper.deleteOMSDBEntriesForOrderID("70042952");
		omsServiceHelper.chnageOlderOrdersToOnlineForCODTesting(uidx, login);
		DBUtilities.exUpdateQuery(payment_Plan_70042952, "pps");
		DBUtilities.exUpdateQuery(payment_plan_item_70042952, "pps");
		DBUtilities.exUpdateQuery(payment_plan_item_instrument_70042952, "pps");
		DBUtilities.exUpdateQuery(payment_plan_instrument_Details_70042952, "pps");
		omsServiceHelper.createOrderInOMS(order_pps_70042952);

		Object[][] dataSet = new Object[][] { { "70042952", login } };
		return Toolbox.returnReducedDataSet(dataSet, testContext.getIncludedGroups(), 11, 11);
	}

	@DataProvider(name = "cancelReleaseOfADeliveredOrderDP")
	public static Object[][] cancelReleaseOfADeliveredOrderDP(ITestContext testContext)
			throws SQLException, UnsupportedEncodingException, JAXBException {
		String order_pps_70042952 = "<order><createdBy>end2endautomation1@gmail.com</createdBy><createdOn>2016-02-29T12:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":19+05:30</createdOn><id>70042952</id><lastModifiedOn>2016-02-29T13:14:15+05:30</lastModifiedOn><version>3</version><billingAddress><createdBy>pps-admin</createdBy><createdOn>2016-02-29T13:15:10+05:30</createdOn><id>1547</id><lastModifiedOn>2016-02-29T13:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":54+05:30</lastModifiedOn><version>0</version><billingAddress></billingAddress><billingCity></billingCity><billingCounty></billingCounty><billingEmail>end2endautomation1@gmail.com</billingEmail><billingFirstName></billingFirstName><billingLastName></billingLastName><billingMobile>9439543863</billingMobile><billingState></billingState><billingZipCode></billingZipCode></billingAddress><cartDiscount>0</cartDiscount><cashBackCouponCode></cashBackCouponCode><cashRedeemed>0</cashRedeemed><cashbackOffered>0</cashbackOffered><channel>web</channel><codCharge>0</codCharge><couponCode></couponCode><couponDiscount>0</couponDiscount><customerName>END2END Automation1</customerName><discount>0</discount><earnedCredit>0</earnedCredit><emiCharge>0</emiCharge><finalAmount>801</finalAmount><giftCardAmount>0</giftCardAmount><giftCharge>0</giftCharge><giftOrder>false</giftOrder><login>end2endautomation1@gmail.com</login><loyaltyConversionFactor>0</loyaltyConversionFactor><loyaltyPointsCredit>0</loyaltyPointsCredit><loyaltyPointsUsed>0</loyaltyPointsUsed><mrpTotal>799</mrpTotal><notes></notes><onHold>false</onHold><orderProcessingFlowMode>OMS</orderProcessingFlowMode><orderReleases><orderRelease><createdBy>end2endautomation1@gmail.com</createdBy><createdOn>2016-02-29T12:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":19+05:30</createdOn><id>70042952</id><lastModifiedOn>2016-02-29T13:35:24+05:30</lastModifiedOn><version>10</version><address>Myntra Design, AKR B</address><addressId>6118982</addressId><cartDiscount>0</cartDiscount><cashRedeemed>0</cashRedeemed><city>Bangalore</city><codCharge>0</codCharge><codPaymentStatus>pending</codPaymentStatus><country>India</country><couponDiscount>0</couponDiscount><courierCode>ML</courierCode><courierDisplayName>Myntra Logistics</courierDisplayName><customerPromiseTime>2016-03-04T23:01:02+05:30</customerPromiseTime><discount>0</discount><earnedCredit>0</earnedCredit><email>8861d0a4.f190.4a91.b392.965c152b3914CLcZYByF9R</email><emiCharge>0</emiCharge><expectedCutoffTime>2016-02-29T23:01:02+05:30</expectedCutoffTime><expectedDeliveryPromise>2016-03-04T23:01:02+05:30</expectedDeliveryPromise><expectedPackingTime>2016-02-29T23:00:24+05:30</expectedPackingTime><expectedPickingTime>2016-02-29T21:00:24+05:30</expectedPickingTime><expectedQCTime>2016-02-29T21:00:24+05:30</expectedQCTime><finalAmount>801</finalAmount><gift>false</gift><giftCardAmount>0</giftCardAmount><giftCharge>0</giftCharge><locality>Bommanahalli  &#x28;Bangalore&#x29;</locality><login>end2endautomation1@gmail.com</login><loyaltyConversionFactor>0</loyaltyConversionFactor><loyaltyPointsCredit>0</loyaltyPointsCredit><loyaltyPointsUsed>0</loyaltyPointsUsed><mobile>9439543863</mobile><mrpTotal>799</mrpTotal><onHold>false</onHold><orderId>70042952</orderId><orderLines><orderLine><createdBy>end2endautomation1@gmail.com</createdBy><createdOn>2016-02-29T12:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":19+05:30</createdOn><id>52700694</id><lastModifiedOn>2016-02-29T13:32:46+05:30</lastModifiedOn><version>3</version><cartDiscount>0</cartDiscount><cashRedeemed>0</cashRedeemed><cashbackOffered>0</cashbackOffered><couponDiscount>0</couponDiscount><customizedMessage></customizedMessage><discount>0</discount><discountRuleId>0</discountRuleId><discountRuleRevId>0</discountRuleRevId><discountedProduct>false</discountedProduct><discountedQuantity>0</discountedQuantity><earnedCredit>0</earnedCredit><finalAmount>799</finalAmount><fragile>false</fragile><giftCardAmount>0</giftCardAmount><govtTaxAmount>39.95</govtTaxAmount><govtTaxRate>5.25</govtTaxRate><govtTaxType>CST</govtTaxType><govtTaxableAmount>761.05</govtTaxableAmount><hazMat>false</hazMat><isCustomizable>false</isCustomizable><isDiscountedProduct>false</isDiscountedProduct><isExchangeableProduct>true</isExchangeableProduct><isFragile>false</isFragile><isHazMat>false</isHazMat><isJewellery>false</isJewellery><isReturnableProduct>true</isReturnableProduct><jewellery>false</jewellery><loyaltyConversionFactor>0</loyaltyConversionFactor><loyaltyPointsAwarded>0</loyaltyPointsAwarded><loyaltyPointsCredit>0</loyaltyPointsCredit><loyaltyPointsUsed>0</loyaltyPointsUsed><optionId>4853</optionId><orderId>70042952</orderId><orderReleaseId>70042952</orderReleaseId><packagingStatus>NOT_PACKAGED</packagingStatus><packagingType>NORMAL</packagingType><pgDiscount>0</pgDiscount><poStatus>UNUSED</poStatus><quantity>1</quantity><sellerId>21</sellerId><skuId>3832</skuId><status>D</status><statusDisplayName>QA Done</statusDisplayName><storedCredit>0</storedCredit><styleId>1531</styleId><supplyType>ON_HAND</supplyType><taxAmount>0</taxAmount><taxRate>5.5</taxRate><unitPrice>799</unitPrice></orderLine></orderLines><packedOn>2016-02-29T13:35:24+05:30</packedOn><paymentMethod>on</paymentMethod><paymentMethodDisplay>Online</paymentMethodDisplay><personalized>false</personalized><pgDiscount>0</pgDiscount><queuedOn>2016-02-29T12:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":24+05:30</queuedOn><receiverName>END2END Automation1 </receiverName><refunded>false</refunded><sellerProcessingEndTime>2016-03-02T17:07:25+05:30</sellerProcessingEndTime><sellerProcessingStartTime>2016-02-29T12:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":25+05:30</sellerProcessingStartTime><shippingCharge>2</shippingCharge><shippingMethod>NORMAL</shippingMethod><singleItemRelease>false</singleItemRelease><specialPincode>false</specialPincode><state>KA</state><status>DL</status><statusDisplayName>Delivered</statusDisplayName><storeId>1</storeId><storedCredit>0</storedCredit><taxAmount>0</taxAmount><trackingNo>ML0008941697</trackingNo><userContactNo>9439543863</userContactNo><warehouseId>28</warehouseId><zipcode>560068</zipcode></orderRelease></orderReleases><orderType>on</orderType><orderTypeDisplay>Online</orderTypeDisplay><paymentMethod>on</paymentMethod><paymentMethodDisplay>Online</paymentMethodDisplay><paymentPpsId>a3fb8404-1ee2-40e1-b272-dca183381418</paymentPpsId><pgDiscount>0</pgDiscount><queuedOn>2016-02-29T12:"+OMSTCConstants.WareHouseIds.warehouseId19_BG+":24+05:30</queuedOn><shippingCharge>2</shippingCharge><storeId>1</storeId><storedCredit>0</storedCredit><taxAmount>0</taxAmount><totalOrderValue>801</totalOrderValue><userContactNo>9439543863</userContactNo></order>";
		String payment_Plan_70042952 = "INSERT INTO `payment_plan` (`id`, `comments`, `updatedBy`, `updatedTimestamp`, `actionType`, `clientTransactionId`, `crmRefId`, `login`, `orderId`, `ppsType`, `sourceId`, `state`, `sessionId`, `cartContext`, `totalAmount`, `mobile`, `returnId`, `userAgent`, `clientIP`, `bankAccountId`) VALUES ('a3fb8404-1ee2-40e1-b272-dca183381418', 'PPS Plan created', 'SYSTEM', 1456728558921, 'SALE', NULL, NULL, 'end2endautomation1@gmail.com', '70042952', 'ORDER', '1ecaadd1-0f40-4b6e-baec-77ea8b9dae71--s3', 'PPFSM Order Taking done', 'JJN001ce88a2cd78594db585da2a65f809db271456728487M', 'DEFAULT', 80100, NULL, NULL, NULL, '1.1.1.1', NULL);";
		String payment_plan_item_70042952 = "INSERT INTO `payment_plan_item` (`id`, `comments`, `updatedBy`, `updatedTimestamp`, `itemType`, `pricePerUnit`, `quantity`, `sellerId`, `skuId`, `pps_Id`) VALUES (99942170, 'Payment Plan Item created', 'SYSTEM', 1456728559076, 'SKU', 79900, 1, '1', '3832', 'a3fb8404-1ee2-40e1-b272-dca183381418'), (99942171, 'Payment Plan Item created', 'SYSTEM', 1456728559076, 'SHIPPING_CHARGES', 200, 1, '1', 'PPS_9999', 'a3fb8404-1ee2-40e1-b272-dca183381418');";
		String payment_plan_item_instrument_70042952 = "INSERT INTO `payment_plan_item_instrument` (`id`, `comments`, `updatedBy`, `updatedTimestamp`, `amount`, `paymentInstrumentType`, `ppsItemId`, `actionType`) VALUES (31532, 'Payment Plan Item Instrument Detail created', 'SYSTEM', 1456728559077, 79900, 5, 99942170, NULL), (31533, 'Payment Plan Item Instrument Detail created', 'SYSTEM', 1456728559077, 200, 5, 99942171, NULL);";
		String payment_plan_instrument_Details_70042952 = "INSERT INTO `payment_plan_instrument_details` (`id`, `comments`, `updatedBy`, `updatedTimestamp`, `paymentInstrumentType`, `totalPrice`, `pps_Id`, `paymentPlanExecutionStatus_id`, `actionType`, `parentInstrumentDetailId`) VALUES(21931, 'PPS Plan Instrument Details created', 'SYSTEM', 1456728559076, 5, 80100, 'a3fb8404-1ee2-40e1-b272-dca183381418', 9862055, 'DEBIT', NULL);";

		omsServiceHelper.deletePPSRecords("'a3fb8404-1ee2-40e1-b272-dca183381418'");
		omsServiceHelper.deleteOMSDBEntriesForOrderID("70042952");
		omsServiceHelper.chnageOlderOrdersToOnlineForCODTesting(uidx,login);
		DBUtilities.exUpdateQuery(payment_Plan_70042952, "pps");
		DBUtilities.exUpdateQuery(payment_plan_item_70042952, "pps");
		DBUtilities.exUpdateQuery(payment_plan_item_instrument_70042952, "pps");
		DBUtilities.exUpdateQuery(payment_plan_instrument_Details_70042952, "pps");
		omsServiceHelper.createOrderInOMS(order_pps_70042952);

		Object[][] dataSet = new Object[][] { { "70042952", login } };
		return Toolbox.returnReducedDataSet(dataSet, testContext.getIncludedGroups(), 11, 11);
	}

	@DataProvider(name = "creatingExchangeOrderAgainstCancelledLinesShouldNotAllowedDP")
	public static Object[][] creatingExchangeOrderAgainstCancelledLinesShouldNotAllowedDP(ITestContext testContext)
			throws Exception {
	
		String orderID;
		String skuId[] = { OMSTCConstants.OtherSkus.skuId_3832+":2"};
        atpserviceHelper.updateInventoryDetailsForSeller(new String[] {OMSTCConstants.OtherSkus.skuId_3832+":"+OMSTCConstants.WareHouseIds.warehouseId1_BA+","+OMSTCConstants.WareHouseIds.warehouseId28_GN+","+OMSTCConstants.WareHouseIds.warehouseId36_BW+":1000:0:"+vectorSellerID+":1"},supplyTypeOnHand);
        IMSServiceHelper.updateInventoryForSeller(new String[] {OMSTCConstants.OtherSkus.skuId_3832+":"+OMSTCConstants.WareHouseIds.warehouseId28_GN+","+OMSTCConstants.WareHouseIds.warehouseId36_BW+":1000:0:"+vectorSellerID},supplyTypeOnHand);
		orderID = end2EndHelper.createOrder(login, password, OMSTCConstants.Pincodes.PINCODE_560068, skuId, "", false, false, false,"",false);
				
		Object[][] dataSet = new Object[][] { { orderID, login } };
		return Toolbox.returnReducedDataSet(dataSet, testContext.getIncludedGroups(), 1, 1);
	}



}
